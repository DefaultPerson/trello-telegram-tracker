# Product Requirements Document (PRD)
## Trello Telegram Tracker Bot

### Project Overview
**Product Name:** Trello Telegram Tracker Bot
**Type:** Telegram Bot for Trello board monitoring
**Language:** Python 3.12+
**Architecture:** Asynchronous modular architecture

### Core Purpose
Automation of monitoring and reporting on Trello boards via a Telegram bot with real-time notifications and automated reports.

### Key Features

#### 1. Real-time Monitoring
- **Card Completion Tracking:** Automatic notifications when cards are completed
- **Member Assignment Notifications:** Notifications when members are assigned to tasks
- **Long-running Task Detection:** Indication of tasks in progress for more than 3 days (üêå)
- **Continuous Monitoring:** Checking for changes every 30 seconds

#### 2. Automated Reporting
- **Daily Reports:** Daily reports (Mon-Sat at 8:00 AM) with overdue and current tasks
- **Weekly Statistics:** Weekly statistics (Mon at 12:00 AM) with completed tasks
- **Report Pinning:** Automatic pinning of reports with deletion of old ones

#### 3. Interactive Commands
- `/start` - Help and list of commands
- `/ct` - Current report for all boards
- `/wr` - Weekly statistics
- `/mt` - Personal tasks of the user
- `/stored` - Show pinned messages
- `/unpin MESSAGE_ID` - Unpin message
- `/clear_stored` - Clear saved messages
- `/debug_file` - Show storage file

#### 4. User Management
- **Trello-Telegram Mapping:** Linking Trello users with Telegram usernames
- **Personal Task Views:** Personal task reports for the user
- **Tag Notifications:** Automatic mentions in notifications

### Technical Architecture

#### Core Components
1. **AsyncTrelloBot** (`bot.py`) - Main bot class with aiogram
2. **TrelloAPI** (`trello_api.py`) - Integration with Trello API
3. **CommandHandlers** (`handlers.py`) - Command handlers
4. **ReportGenerator** (`reports.py`) - Report generation
5. **Storage** (`storage.py`) - Working with JSON files
6. **Scheduler** (`scheduler.py`) - Task scheduler
7. **Config** (`config.py`) - System configuration

#### Technology Stack
- **Python 3.12+** - Main language
- **aiogram 3.21+** - Telegram Bot framework
- **aiohttp 3.9+** - Asynchronous HTTP requests
- **aiofiles 24.1+** - Asynchronous file handling
- **schedule 1.2+** - Task scheduler
- **Poetry** - Dependency management

#### Data Storage
- **JSON Files:** Storing card states and pinned messages
- **In-Memory State:** Caching the latest board states
- **Persistent Tracking:** Tracking long-running tasks

### Configuration Requirements

#### Required Settings
- `TELEGRAM_API_TOKEN` - Telegram bot token
- `PEER_ID` - Chat ID for reports
- `TRELLO_API_KEY` - Trello API key
- `TRELLO_TOKEN` - Trello token
- `board_ids` - List of board IDs to monitor

#### User Mappings
- `trello_to_telegram_users` - Trello ‚Üí Telegram user mapping
- `done_list_names` - Names of the "done" lists
- `in_progress_list_names` - Names of the "in progress" lists
